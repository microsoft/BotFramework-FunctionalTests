parameters:
  version: ''
  source: ''
  project: {}
  packages: []

steps:
  - powershell: |
      $version = ''
      $source = ''

      if(-not ([string]::IsNullOrEmpty("${{ parameters.version }}"))){
        $version = "--version ""${{ parameters.version }}"""
      }

      if(-not ([string]::IsNullOrEmpty("${{ parameters.source }}"))){
        $source = "--source ""${{ parameters.source }}"""
      }

      foreach ($package in "${{ parameters.packages }}".Split()) {
        Invoke-Expression "dotnet add ""${{ parameters.project.directory }}/${{ parameters.project.name }}"" package $version $source $package"
      }

      write-host " `nPackages:"
      foreach ($package in "${{ parameters.packages }}".Split()) {
        write-host "  - $package"
      }
    displayName: 'Install dependencies' 
