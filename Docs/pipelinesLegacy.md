# Skills Functional Tests (Legacy Pipelines)

## Summary

Skill functional testing aims to automate the testing for the combination of Host and Skill bots and its interactions in all available programming languages.

The matrix consists of all the available combinations to test in this repository. Each table cell has a badge that represents a pipeline that runs every night using the latest preview version of the BotBuilder packages.

**Note: This matrix has been expanded on the newer version of the pipelines, click [here](./pipelines.md) for more information.**

| Host/Skill        | C# Net Core 2.1                                                                                                                                                       | C# Net Core 3.1                                                                                                                                                       | JavaScript                                                                                                                                                | Python                                                                                                                                                    | v3 Javascript                                                                                                                                     | v3 C#                                                                                                                                                 |
| -                 | -                                                                                                                                                                     | -                                                                                                                                                                     | -                                                                                                                                                         | -                                                                                                                                                         | -                                                                                                                                                 | -                                                                                                                                                     |
| C# Net Core 2.1   | ![DotNet21DotNet21SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet21DotNet21SkillBotFunctionalTest?branchName=main)  | ![DotNet21DotNet31SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet21DotNet31SkillBotFunctionalTest?branchName=main)  | ![DotNet21JsSkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet21JsSkillBotFunctionalTest?branchName=main)  | ![DotNet21PySkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet21PySkillBotFunctionalTest?branchName=main)  | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/DotNet21JsV3SkillBotFunctionalTest?branchName=main) | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/DotNet21DotNetV3SkillBotFunctionalTest?branchName=main) |
| C# Net Core 3.1   | ![DotNet31DotNet21SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet31DotNet21SkillBotFunctionalTest?branchName=main)  | ![DotNet31DotNet31SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet31DotNet31SkillBotFunctionalTest?branchName=main)  | ![DotNet31JsSkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet31JsSkillBotFunctionalTest?branchName=main)  | ![DotNet31PySkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/DotNet31PySkillBotFunctionalTest?branchName=main)  | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/DotNet31JsV3SkillBotFunctionalTest?branchName=main) | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/DotNet31DotNetV3SkillBotFunctionalTest?branchName=main) |
| JavaScript        | ![JsDotNet21SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/JsDotNet21SkillBotFunctionalTest?branchName=main)              | ![JsDotNet31SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/JsDotNet31SkillBotFunctionalTest?branchName=main)              | ![JsJsSkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/JsJsSkillBotFunctionalTest?branchName=main)              | ![JsPySkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/JsPySkillBotFunctionalTest?branchName=main)              | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/JsJsV3SkillBotFunctionalTest?branchName=main)       | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/JsDotNetV3SkillBotFunctionalTest?branchName=main)       |
| Python            | ![PyDotNet21SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/PyDotNet21SkillBotFunctionalTest?branchName=main)              | ![PyDotNet31SkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/PyDotNet31SkillBotFunctionalTest?branchName=main)              | ![PyJsSkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/PyJsSkillBotFunctionalTest?branchName=main)              | ![PyPySkillBotFunctionalTest](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/PyPySkillBotFunctionalTest?branchName=main)              | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/PyJsV3SkillBotFunctionalTest?branchName=main)       | ![V3SkillBots](https://dev.azure.com/FuseLabs/SDK_v4/_apis/build/status/SkillBots/V3SkillBots/PyDotNetV3SkillBotFunctionalTest?branchName=main)       |

## Content

This section uses a `SimpleHostBot` and an `EchoSkillBot` sample for each language available to run the functional tests. We use YAML files to set up a pipeline that deploys a pair of Host and Skill bots to Azure and then run functional tests where the HostBot consumes the SkillBot.

The functional tests are located in the [Tests](../Tests) directory. These tests are written in DotNet and can be used to test the bots independently of the language these are written in. For this, the tests use the [TranscriptTestRunner](../Libraries/TranscriptTestRunner) library to run a recorded transcript and communicate with the bots deployed to Azure using a [direct line channel](https://docs.microsoft.com/en-us/azure/bot-service/bot-service-channel-directline) to the `HostBot` and compare the messages received from the bot in different scenarios.

### Tests

The following tests are run in the pipeline using the Host and Skill bots deployed in Azure through a DirectLine connection with the Host bot.

| Name                                                      | Description                                                                                   | Additional Info                       |
| -                                                         | -                                                                                             | -                                     |
| SimpleHostBotToEchoSkilTest.ShouldRedirectToSkill         | Tests that the host bot communicates with the skill bot when asked.                           |                                       |
| SimpleHostBotToEchoSkilTest.HostReceivesEndOfConversation | Tests that the skill bot returns the control of the conversation to the host bot when asked.  |                                       |
| OAuthSkillTest.ShouldSignIn                               | Tests that the skill bot Sign In successfully using the OAuth service.                        | Skipped when a v3 Skill bot is used   |

### Usage

The [How to setup Pipeline document](../Docs/setupPipelines.md) will guide you trough the creation of a pipeline. If you want to test every combination, you have to create one pipeline for each host-sklill pair yaml in the [build/yamls](../build/yaml) directory.

In the following table shows which YAML corresponds with each host-skill pair to be tested.

| Host\Skill            | C# Net Core 3.1                                                                   | JavaScript                                                                                | Python                                                                            | C# Net Core 2.1                                                                   | v3 Javascript                                                                                 | v3 C#                                                                                 |
| -                     | -                                                                                 | -                                                                                         | -                                                                                 | -                                                                                 | -                                                                                             | -                                                                                     |
| **C# Net Core 3.1**   | [dotnetHost2DotnetSkill.yml(../build/yaml/dotnetHost2dotnetSkill.yml)         | [dotnetHost2JavascriptSkill.yml](../build/yaml/dotnetHost2JavascriptSkill.yml)         | [dotnetHost2PythonSkill.yml](../build/yaml/dotnetHost2PythonSkill.yml)         | [dotnetHost2DotnetSkill.yml](../build/yaml/dotnetHost2dotnetSkill.yml)         | [dotnetHost2JavascriptV3Skill.yml](../build/yaml/dotnetHost2JavascriptV3Skill.yml)         | [dotnetHost2DotnetV3Skill.yml](../build/yaml/dotnetHost2DotnetV3Skill.yml)         |
| **JavaScript**        | [javascriptHost2DotnetSkill.yml](../build/yaml/javascriptHost2DotnetSkill.yml) | [javascriptHost2JavascriptSkill.yml](../build/yaml/javascriptHost2JavascriptSkill.yml) | [javascriptHost2PythonSkill.yml](../build/yaml/javascriptHost2PythonSkill.yml) | [javascriptHost2DotnetSkill.yml](../build/yaml/javascriptHost2DotnetSkill.yml) | [javascriptHost2JavascriptV3Skill.yml](../build/yaml/javascriptHost2JavascriptV3Skill.yml) | [javascriptHost2DotnetV3Skill.yml](../build/yaml/javascriptHost2DotnetV3Skill.yml) |
| **Python**            | [pythonHost2DotnetSkill.yml](../build/yaml/pythonHost2DotnetSkill.yml)         | [pythonHost2JavascriptSkill.yml](../build/yaml/pythonHost2JavascriptSkill.yml)         | [pythonHost2PythonSkill.yml](../build/yaml/pythonHost2PythonSkill.yml)         | [pythonHost2DotnetSkill.yml](../build/yaml/pythonHost2DotnetSkill.yml)         | [pythonHost2JavascriptV3Skill.yml](../build/yaml/pythonHost2JavascriptV3Skill.yml)         | [pythonHost2DotnetV3Skill.yml](../build/yaml/pythonHost2DotnetSkill.yml)           |
| **C# Net Core 2.1**   | [dotnetHost2DotnetSkill.yml](../build/yaml/dotnetHost2dotnetSkill.yml)         | [dotnetHost2JavascriptSkill.yml](../build/yaml/dotnetHost2JavascriptSkill.yml)         | [dotnetHost2PythonSkill.yml](../build/yaml/dotnetHost2PythonSkill.yml)         | [dotnetHost2DotnetSkill.yml](../build/yaml/dotnetHost2dotnetSkill.yml)         | [dotnetHost2JavascriptV3Skill.yml](../build/yaml/dotnetHost2JavascriptV3Skill.yml)         | [dotnetHost2DotnetV3Skill.yml](../build/yaml/dotnetHost2DotnetV3Skill.yml)         |

#### Variables

| Name                                                  | Source                                                                                                                                            | Description                                                                                                                                                                                                       | Options                   |
| -                                                     | -                                                                                                                                                 | -                                                                                                                                                                                                                 | -                         |
| **AzureSubscription**                                 | User                                                                                                                                              | The name of the *Azure Resource Manager service connection* configured in the pipeline.                                                                                                                           | **required**              |
| [[Prefix]](#Prefixes) + **HostAppId**                 | [App Registration](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) Portal                                     | The *Application (client) ID* of the App Registration for your HostBot.                                                                                                                                           | **required**, **private** |
| [[Prefix]](#Prefixes) + **HostAppSecret**             | [App Registration](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) Portal                                     | The secret’s value from the table under *Client secrets* of the App Registration for your HostBot.                                                                                                                | **required**, **private** |
| [[Prefix]](#Prefixes) + **HostBotName**               | User                                                                                                                                              | The name of the HostBot that will be used to deploy it to Azure.                                                                                                                                                  | **required**              |
| [[Prefix]](#Prefixes) + **SkillAppId**                | [App Registration](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) Portal                                     | The *Application (client) ID* of the App Registration for your SkillBot.                                                                                                                                          | **required**, **private** |
| [[Prefix]](#Prefixes) + **SkillAppSecret**            | [App Registration](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) Portal                                     | The secret’s value from the table under *Client secrets* of the App Registration for your SkillBot.                                                                                                               | **required**, **private** |
| [[Prefix]](#Prefixes) + **SkillBotName**              | User                                                                                                                                              | The name of the SkillBot that will be used to deploy it to Azure.                                                                                                                                                 | **required**              |
| **AzureDeploymentUser**                               | [Webapp Deployment User](https://docs.microsoft.com/en-us/cli/azure/webapp/deployment/user?view=azure-cli-latest#az-webapp-deployment-user-set)   | The Azure deployment user required to deploy using git.                                                                                                                                                           | **python**                |
| **AzureDeploymentPassword**                           | [Webapp Deployment User](https://docs.microsoft.com/en-us/cli/azure/webapp/deployment/user?view=azure-cli-latest#az-webapp-deployment-user-set)   | The Azure deployment password required to deploy using git.                                                                                                                                                       | **python**                |
| **BotBuilderPackageVersionHost**                      | User                                                                                                                                              | The version of the BotBuilder package the Host bot will use. If not set, the latest preview version will be used, set it to **stable** to install latest stable version or specify the version you want to use.   | **optional**              |
| **BotBuilderPackageVersionSkill**                     | User                                                                                                                                              | The version of the BotBuilder package the Skill bot will use. If not set, the latest preview version will be used, set it to **stable** to install latest stable version or specify the version you want to use.  | **optional**              |
| **DeleteResourceGroup**                               | User                                                                                                                                              | Set this variable to **false** if you want to skip the step to delete the resources in Azure after the tests.                                                                                                     | **optional**              |
| **ExecutePipelinesPersonalAccessToken**               | User                                                                                                                                              | The Access Token for triggering the next build in the chain.                                                                                                                                                      | **optional**              |
| **NetCoreSdkVersionHost**                             | User                                                                                                                                              | The version of the NetCore SDK the Host bot will use. This variable is required for dotnet Host bots. The supported values are 2.1 and 3.1, any other value will cause the pipeline to fail.                      | **dotnet**                |
| **NetCoreSdkVersionSkill**                            | User                                                                                                                                              | The version of the NetCore SDK the Skill bot will use. This variable is required for dotnet Skill bots. The supported values are 2.1 and 3.1, any other value will cause the pipeline to fail.                    | **dotnet**                |
| **NextBuild**                                         | User                                                                                                                                              | The name of the next build in the chain.                                                                                                                                                                          | **optional**              |
| **RegistryUrlHost** </br> **RegistryUrlSkill**        | User                                                                                                                                              | The registry where the BotBuilder packages will be downloaded. <br><br> Available registry options: <ul><li>**C# (.Net)**<ul><li>**Artifacts**</li><li>**MyGet**</li><li>**NuGet**</li><li>**Custom (*)**</li><li>**Default:** Artifacts (**)</li></ul> </li><li>**JavaScript**<ul><li>**MyGet**</li><li>**Npm**</li><li>**Custom (*)**</li><li>**Default:** MyGet</li></ul></li> <li>**Python**<ul><li>**Artifacts**</li><li>**PyPi**</li><li>**Test.PyPi**</li><li>**Custom (*)**</li><li>**Default:** Artifacts</li></ul> </li></ul> <br> **(*) Custom:** Any public feed URL. <br> **(\*\*) C# default:** V3 bot uses default MyGet.  | **optional** |
| **TestFilter**                                        | User                                                                                                                                              | Set this variable with arguments to filter out tests. `&TestCategory!=SkipForV3Bots` **This will omit the tests with Category "SkipForV3Bots".**                                                                  | **optional**              |
| **TriggeredBy**                                       | User                                                                                                                                              | The name of the previous build from which was triggered.                                                                                                                                                          | **optional**              |

##### Prefixes

| Host\Skill            | C# Net Core 3.1   | JavaScript    | Python    | C# Net Core 2.1   | v3 Javascript | v3 C#             |
| -                     | -                 | -             | -         | -                 | -             | -                 |
| **C# Net Core 3.1**   | DotNetDotNet      | DotNetJs      | DotNetPy  | DotNetDotNet      | DotNetJsV3    | DotNetDotNetV3    |
| **JavaScript**        | JsDotNet          | JsJs          | JsPy      | JsDotNet          | JsJsV3        | JsDotNetV3        |
| **Python**            | PyDotNet          | PyJs          | PyPy      | PyDotNet          | PyJsV3        | PyDotNetV3        |
| **C# Net Core 2.1**   | DotNetDotNet      | DotNetJs      | DotNetPy  | DotNetDotNet      | DotNetJsV3    | DotNetDotNetV3    |

###### Options

| Name          | Description                                               |
| -             | -                                                         |
| **required**  | These variables are required/mandatory.                   |
| **optional**  | These variables are optional/non mandatory.               |
| **private**   | These variables are private.                              |
| **python**    | These variables are required when a python bot is used.   |
| **dotnet**    | These variables are required when a dotnet bot is used.   |
